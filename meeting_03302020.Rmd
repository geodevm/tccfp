---
title: "meeting_03302020"
author: "Geoff Miller"
date: "3/30/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
knitr::opts_knit$set(root.dir = "C:/Users/Geoffrey/Desktop/")
```

## Sex by species

#### Note that 1 coyote was not collared (captured at same time/location as one that was collared).

```{r}
collars <- read.csv("C:/Users/Geoffrey/Desktop/collars_cleaned.csv")
biologicals <- read.csv("C:/Users/Geoffrey/Desktop/biologicals_cleaned.csv")
sex <- table(biologicals$sex, biologicals$species)
barplot(sex, xlab = "species", legend = rownames(sex))
```

## Whether scat sample was collected.

```{r}
scat <- table(biologicals$scat, biologicals$species)
barplot(scat, xlab = "species", legend = rownames(scat))
```

## Whether fecal sample was collected.

```{r}
fecal <- table(biologicals$fecal, biologicals$species)
barplot(fecal, xlab = "species", legend = rownames(fecal))
```

## Whether hair sample was collected.

```{r}
hair <- table(biologicals$hair, biologicals$species)
barplot(hair, xlab = "species", legend = rownames(hair))
```

```{r}
blood <- table(biologicals$blood_collected, biologicals$species)
barplot(blood, xlab = "species", legend = rownames(blood))
```

## Map of all locations to date.

```{r}
packages_needed <- c("knitr", "lubridate", "maptools", "raster", "move", 
                     "amt",  "tibble", "leaflet", "dplyr", "readr", "ggplot2", 
                     "glmmTMB", "lme4", "tidyr", "purrr", "glue", "sf", 
                     "here", "moveVis", "GGally", "devtools", "TwoStepCLogit", 
                     "broom", "tictoc", "ezknitr", "moveVis", "maps", "rgeos", 
                     "maptools")
new_packages <- packages_needed[!(packages_needed %in% 
                                    installed.packages()[,"Package"])]
if(length(new_packages)) 
  install.packages(new_packages, repos = "https://cloud.r-project.org")

library(knitr)
library(lubridate)
library(maptools)
library(raster)
library(move)
library(amt) 
library(tibble)
library(leaflet)
library(dplyr)
library(readr)
library(ggplot2)
library(glmmTMB)
library(sf)
library(here)
options(width=165,digits.secs = 3)
opts_chunk$set(fig.width=12,fig.height=4.5, error=TRUE,cache = FALSE)
canid.dat <- as(collars, "data.frame")
canid.dat <- canid.dat %>% mutate(acquisition_time = ymd_hms(acquisition_time, tz = "UTC"))
leaflet(collars) %>% addTiles()%>%
  addCircles(canid.dat$gps_longitude, canid.dat$gps_latitude)
```

## Locations by animal ID number

```{r}
ggplot(canid.dat, 
       aes(gps_longitude, gps_latitude, color = animal_id, 
           group = animal_id))+
  geom_point() + coord_equal() +
  theme(legend.position = "bottom")
```

## Urbanization in the TCMA.

#### Urbanization index is arbitrary - population is given a weight 5 times percent impervious surface.

![](/Users/Geoffrey/Desktop/tcma.png)

## Home ranges (100% MCP).
#### Green is red foxes, blue is coyotes.

![](/Users/Geoffrey/Desktop/ranges.png)

## Core TCMA with ranges.

![](/Users/Geoffrey/Desktop/zoom.png)

## Index values

#### Horizontal lines = quartiles, vertical = species divide.

```{r}
joined <- read.csv("C:/Users/Geoffrey/Desktop/joined_data.csv")
list <- tapply(joined$X.2imp_pop, joined$animal_id, mean, na.rm = TRUE)
plot(list)
abline(0.063, 0)
abline(0.101, 0)
abline(0.149, 0)
abline(v = 8.5)
```

## Turn angles relative to North

```{r}
trk <- make_track(canid.dat, .x = gps_longitude, .y = gps_latitude, 
                  .t = acquisition_time, id = animal_id, crs = CRS("+proj=utm +zone=15 +ellps=GRS80 +datum=NAD83 +no_defs"))
trk <- trk %>% time_of_day()
nesttrk <- trk %>% group_by(id) %>%
  nest()

temp <- direction_rel(nesttrk$data[[1]])
temp <- trk %>% filter(id=="F1") %>% direction_rel
trk1 <- trk %>% group_by(id) %>% nest() %>% as.data.frame() %>% 
  mutate(dir_abs = map(data, direction_abs, full_circle = TRUE, zero = "N", clockwise = TRUE), 
         dir_rel = map(data, direction_rel), 
         sl = map(data, step_lengths),
         nsd_=map(data, nsd),
         ) %>% unnest()
trk1 <- trk1 %>% 
  mutate(
    week = week(t_),
    month = month(t_, label=TRUE), 
    year = year(t_),
    hour = hour(t_)
  )
ggplot(trk1, aes(x = dir_abs, y = ..density..)) + 
  geom_histogram(breaks = seq(0, 2 * pi, len = 30))+
  coord_polar(start = 0) + theme_minimal() + 
  scale_fill_brewer() + labs(y = "Density", title = "Angles Direct") + 
  scale_x_continuous(limits = c(0, 2 * pi), 
                     breaks = c(0, pi/2, pi, 3 * pi/2), 
                     labels = c("0", "pi/2", "pi", "3pi/2")) +
  facet_wrap( ~ id)
```

## Relative turn angles

```{r}
ggplot(trk1, aes(x = dir_rel, y = ..density..)) + 
  geom_histogram(breaks = seq(-pi, pi, length = 20))+
  coord_polar(start = 0) + theme_minimal() +
  scale_fill_brewer() + ylab("Density") + ggtitle("Angles Direct") + 
  scale_x_continuous(limits = c(-pi, pi), breaks = c(-pi, -pi/2, 0, pi/2, pi), 
                     labels = c("-pi", "-pi/2", "0", "pi/2", "pi")) +
  facet_wrap(~id)
```

## Net-squared displacement

```{r}
ggplot(trk1, aes(x = t_, y = nsd_)) + geom_path()+
  facet_wrap(~id, scales = "free")
```

## Activity levels at day vs. night by animal

```{r}
ggplot(trk1, aes(x = tod_, y = log(sl))) + 
  geom_boxplot() + geom_smooth() + facet_wrap(~id)
```
